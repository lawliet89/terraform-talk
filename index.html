<!doctype html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

	<title>Infrastructure as code with Terraform</title>

	<link rel="stylesheet" href="css/reveal.css">
	<link rel="stylesheet" href="css/theme/black.css">

	<!-- Theme used for syntax highlighting of code -->
	<link rel="stylesheet" href="lib/css/zenburn.css">

	<!-- Printing and PDF exports -->
	<script>
		var link = document.createElement('link');
		link.rel = 'stylesheet';
		link.type = 'text/css';
		link.href = window.location.search.match(/print-pdf/gi) ? 'css/print/pdf.css' : 'css/print/paper.css';
		document.getElementsByTagName('head')[0].appendChild(link);
	</script>
</head>

<body>
	<div class="reveal">
		<div class="slides">
			<section>
				Automating the α and the Ω of Your Infrastructure
				<small>Automatic creation and destruction through Infrastructure as code</small>

				<aside class="notes">
					<p>
						Managing huge and complex infrastructure is difficult. The same problem exists even when running your own bare metal racks
						or on the cloud. Nowadays, many cloud providers and stacks provide rich sets of API for users to manage and run their
						infrastructure. This is ripe for software to automate the management of infrastructure. </p>

					<p>
						Using Infrastructure as Code allows us to track changes, reason about infrastructure and even reproduce an exact replica
						of the infrastructure. Terraform is one such tool that works across many cloud providers and service providers such
						as Cloudflare.
					</p>

				</aside>
			</section>

			<section>
				<section>
					<h2>Problems with Managing Infrastructure (Manually)
					</h2>
				</section>

				<section>
					<h3>Visibility</h3>
					<ul>
						<li>Details are siloed in someone's head</li>
						<li>Changes are not visible</li>
						<li>Dependencies are hard to see</li>
					</ul>

					<aside class="notes">
						<ul>
							<li>Difficult to see the whole "big picture" of your infrastructure configuration</li>
							<li>Difficult to tell what the rationale for some of the configuration is</li>
							<li>Changes are not easily trackable -- what got changed by whom when?</li>
							<li>No easy way to enforce visibility and review of changes</li>
							<li>Hard to tell what depends on what</li>
						</ul>
					</aside>
				</section>

				<section>
					<h3>Difficulty</h3>
					<ul>
						<li>Almost impossible to replicate</li>
						<li>Different APIs for different cloud providers</li>
						<li>Tedious and prone to errors</li>
					</ul>

					<aside class="notes">
						<ul>
							<li>Manual configuration and setting makes it really difficult to replicate</li>
							<li>Imagine having to set up multiple environments (like staging and production)</li>
							<li>Imagine trying to configure something repetitively: e.g. AWS config for ALL regions. Enable AWS Guard Duty for
								ALL regions (as recommended by AWS).</li>
							<li>You can try to automate this but everyone has their own (different) APIs</li>
						</ul>
					</aside>
				</section>
			</section>

			<section>
				<section>
					<h2>Infrastructure as Code</h2>

					Provision, update, and manage your cloud infrastructure with code.
				</section>

				<section>
					<h3>Benefits</h3>
					<ul>
						<li>Automated</li>
						<li>Version control with VCS like Git</li>
						<li>Replicate just by "copy/pasting" or changing variables</li>
						<li>"Just" read the code to figure out details</li>
						<li>"Just" read the code to figure out dependencies</li>
						<li>Abstraction and reusability</li>
					</ul>
				</section>

				<section>
					<h3>Terraform</h3>
					<ul>
						<li>FOSS and paid versions</li>
						<li>Declarative configuration</li>
						<li>Single format across multiple providers</li>
						<li>Huge list of providers supported</li>
					</ul>

					<aside class="notes" data-markdown>
						<textarea data-template>
							- “Workflow-level abstraction”: Single workflow to provision resources across many provider by writing them in a common configuration
							format and invoked from a single place
							- Terraform will determine the dependencies and relationship between resources.
							- Terraform shows you a plan first before applying any changes, including any diffs
							- Terraform also allows you to manage the provisioning configuration of resources across a huge range of providers, including Kubenetes, Cloudflare and so on

						</textarea>
					</aside>
				</section>

				<section>
					<h3>Ansible/Chef/Puppet</h3>
					<ul>
						<li>Configuration management that can also manage infrastructure</li>
						<li>More "procedural" form of provisioning</li>
						<li>Works well with Terraform — configure after Terraform provisions</li>
					</ul>
				</section>

				<section>
					<h3>CloudFormation/Heat</h3>
					<ul>
						<li>Specific to the service</li>
						<li>Each service has its own syntax</li>
					</ul>
				</section>
			</section>

			<section>
				<section>
					<h2>Demo</h2>
				</section>

				<section>
					<h3>Application</h3>
					<ul>
						<li>Silly Chatroom</li>
						<li>Stateless Static Javascript Client</li>
						<li>Stateful Server</li>
					</ul>

					<div>
						<img src="https://camo.githubusercontent.com/e2ccdf4567b426a81a11c081ee7bdd5dbbd13210/687474703a2f2f692e696d6775722e636f6d2f4a316b3769776e2e706e67"
						 style="max-height: 240px;"> <br>
						<a href="https://github.com/gyng/comicchat">https://github.com/gyng/comicchat</a>
					</div>
				</section>

				<section>
					<h3>Basic Idea</h3>
					<ul>
						<li>ASG for clients and servers separately</li>
						<li>One ELB with different listener rules to target the ASG</li>
					</ul>
				</section>

				<section>
					<h3>Diagram</h3>
					<img src="demo/demo.svg" style="max-height: 480px; background-color: white;)">
				</section>

				<section>
					<h3>Hidden Details...</h3>
					<ul>
						<li>Security groups rules between ELB and EC2 instances</li>
						<li>Launch configuration details for ASG</li>
						<li>Listener for ports</li>
						<li>Redirect HTTP -> HTTPS listner</li>
						<li>Certificate for HTTPS</li>
						<li>Listener rules to handle different host names</li>
						<li>Target groups for ASG</li>
						<li>Dependencies... which should I create first?</li>
						<li>...</li>
					</ul>
				</section>

				<!--
				<section>
					<h3>Terraform Implementation</h3>
					Source code at <a href="https://github.com/lawliet89/terraform-talk/tree/master/demo" target="_blank">https://github.com/lawliet89/terraform-talk/tree/master/demo</a>
				</section>

				<section>
					<h3>Dependency Graph</h3>
					<div style="overflow: auto;">
						<a href="demo/graph.svg" target="_blank"><img src="demo/graph.svg"></a>
					</div>
				</section>

				<section>
					<h3><code>terraform init</code></h3>
					<script src="https://asciinema.org/a/lTJxUdcfzWIuwSuYuSvLDHqIZ.js" id="asciicast-lTJxUdcfzWIuwSuYuSvLDHqIZ" async></script>
				</section>

				<section>
					<h3><code>terraform plan</code></h3>

					<script src="https://asciinema.org/a/RI6aSJOKS2RFWRmW7WoeoK3Bh.js" id="asciicast-RI6aSJOKS2RFWRmW7WoeoK3Bh" async></script>
				</section>

				<section>
					<h3><code>terraform apply</code></h3>

					<script src="https://asciinema.org/a/199040.js" id="asciicast-199040" async></script>
				</section>

				<section>
					<h3>Changing and fixing <code>terraform apply</code></h3>
					<script src="https://asciinema.org/a/w4v5XGo4aod7t3PbJt6H76akC.js" id="asciicast-w4v5XGo4aod7t3PbJt6H76akC" async></script>
				</section>

				<section>
					<h3>Changing implementation details (<a href="https://github.com/lawliet89/terraform-talk/commit/dbb4029952a48db4736e994baee8a485036eba9e"
						 target="_blank">diff</a>)</h3>

					<script src="https://asciinema.org/a/mFBIpF1urJQin0dgeNGseyONK.js" id="asciicast-mFBIpF1urJQin0dgeNGseyONK" async></script>
				</section>

				<section>
					<h3>It works!</h3>
					<a href="https://chat.gahmen.tech">chat.gahmen.tech</a>

					<img src="demo/screenshot.png">
				</section>

				<section>
					<h3><code>terraform destroy</code> — Ω</h3>

					<script src="https://asciinema.org/a/CZSxEyipg4hHvDsYUEIbXBdZg.js" id="asciicast-CZSxEyipg4hHvDsYUEIbXBdZg" async></script>
				</section>

				<section>
					<h3>Recreation — α</h3>

					<script src="https://asciinema.org/a/1CMr2pbjGC54pG8WJY3hZWpjZ.js" id="asciicast-1CMr2pbjGC54pG8WJY3hZWpjZ" async></script>
				</section>
			-->
			</section>
			<section>
				<section>
					<h2>Code Walkthrough</h2>
					Source code at <a href="https://github.com/lawliet89/terraform-talk/tree/master/demo" target="_blank">https://github.com/lawliet89/terraform-talk/tree/master/demo</a>
				</section>

				<section>
					<h4><code>main.tf</code></h4>
					<script src="https://gist.github.com/lawliet89/0fc9196ca0fcf6cb50e22d948ee97286.js"></script>
				</section>

				<section>
					<h4>Required <code>variables.tf</code></h4>
					<script src="https://gist.github.com/lawliet89/b2ae62f9481c1b5cda2bfc929aeb33b9.js"></script>
				</section>

				<section>
					<h4>Optional <code>variables.tf</code></h4>
					<script src="https://gist.github.com/lawliet89/db9bdeac311caba12c682debff5c90a8.js"></script>
				</section>

				<section>
					<h4>Autoscaling Group</h4>
					<script src="https://gist.github.com/lawliet89/e3670e4b1ba06fcd33f53ec5c07b870c.js"></script>
				</section>

				<section>
					<h4>Launch Configuration</h4>
					<div style="transform: scale(0.8); transform-origin: center top">
						<script src="https://gist.github.com/lawliet89/218c246ca5dc1751765a0e036f1452fa.js"></script>
					</div>
				</section>

				<section>
					<h4>Security Group Rules</h4>
					<script src="https://gist.github.com/lawliet89/6293525a06cc85e48372b1cb10f0186d.js"></script>
				</section>

				<section>
					<h4>ELB</h4>
					<script src="https://gist.github.com/lawliet89/83e5885a2df80d313fe4221011727aad.js"></script>
				</section>

				<section>
					<h4>Listeners</h4>
					<div style="transform: scale(0.85); transform-origin: center top">
						<script src="https://gist.github.com/lawliet89/63c1f6ed32a15e67d25832fb3712d623.js"></script>
					</div>
				</section>

				<section>
					<div style="transform: scale(0.75); transform-origin: center top">
						<script src="https://gist.github.com/lawliet89/d1b1fab79da782413b4b1d0d5b6d3c44.js"></script>
					</div>
				</section>

				<section>
					<p>Don't forget extra security rules!</p>
					<script src="https://gist.github.com/lawliet89/eb85987749f754034eed228dedfb8d15.js"></script>
				</section>

				<section>
					<p>Repeat for the server.</p>
				</section>

				<section>
					<h4>Route 53</h4>

					<p>The order we write this does not matter.</p>

					<script src="https://gist.github.com/lawliet89/baa2528f23fd659e4b3c70f8a4e1d172.js"></script>
				</section>
			</section>

			<!-- Demo Guard Duty. Security baseline?-->
		</div>
	</div>

	<script src="lib/js/head.min.js"></script>
	<script src="js/reveal.js"></script>

	<script>
		// More info about config & dependencies:
		// - https://github.com/hakimel/reveal.js#configuration
		// - https://github.com/hakimel/reveal.js#dependencies
		Reveal.initialize({
			fragmentInURL: true,
			progress: true,
			history: true,
			dependencies: [
				{ src: 'plugin/markdown/marked.js' },
				{ src: 'plugin/markdown/markdown.js' },
				{ src: 'plugin/notes/notes.js', async: true },
				{
					src: 'plugin/highlight/highlight.js',
					async: true,
					callback: function () {
						hljs.initHighlightingOnLoad();
					}
				}
			]
		});
	</script>
</body>

</html>
